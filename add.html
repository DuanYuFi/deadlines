---
---
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>{{ site.title }} â€” Add Deadline</title>
    <meta name="description" content="Add your own deadlines locally in your browser.">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ "/static/css/deadlines.css" | prepend:site.baseurl }}" media="screen,projection">
    <link rel="shortcut icon" href="{{ "/static/img/favicon.png" | prepend:site.baseurl }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="{{ "/static/js/store.min.js" | prepend:site.baseurl }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </head>
  <body>
    <div class="top-strip"></div>
    <div class="container">
      <div class="page-header">
        <h1>
          Add a Deadline
          <small><a href="{{ site.baseurl }}/">Back to deadlines</a></small>
        </h1>
        <p>Entries are stored only in your browser using local storage. Clearing site data will remove them.</p>
      </div>

      <div class="row">
        <div class="col-sm-8">
          <form id="deadline-form">
            <div class="form-group">
              <label for="name">Name</label>
              <input id="name" type="text" class="form-control" placeholder="e.g., My Project Milestone" required>
            </div>
            <div class="form-group">
              <label for="details">Details (optional)</label>
              <textarea id="details" class="form-control" rows="3" placeholder="Short description or link"></textarea>
            </div>
            <div class="form-group">
              <label for="datetime">Deadline date and time</label>
              <input id="datetime" type="datetime-local" class="form-control" required>
              <p class="help-block">Uses your local timezone. It will display accordingly on the homepage.</p>
            </div>
            <div class="form-group">
              <label for="tags">Tags (comma-separated)</label>
              <input id="tags" type="text" class="form-control" placeholder="e.g., SEC, PRIV, CONF">
              <p class="help-block">Known tags: {% for type in site.data.types %}<code>{{ type.tag }}</code>{% unless forloop.last %}, {% endunless %}{% endfor %}</p>
            </div>
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" id="clear-all" class="btn btn-link pull-right">Clear all my saved deadlines</button>
          </form>
        </div>
      </div>

      <hr>
      <div class="row">
        <div class="col-sm-12">
          <h3>My saved deadlines</h3>
          <div id="saved-empty" class="text-muted" style="display:none">No saved deadlines yet.</div>
          <div class="table-responsive">
            <table class="table table-striped" id="saved-table" style="display:none">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Details</th>
                  <th>When</th>
                  <th>Tags</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function(){
        var storageKey = '{{ site.domain }}:custom_deadlines';

        function parseTags(input) {
          if (!input) return [];
          return input.split(',').map(function(x){ return x.trim(); }).filter(Boolean);
        }

        function loadAll() {
          var data = store.get(storageKey) || [];
          return Array.isArray(data) ? data : [];
        }

        function saveAll(arr) {
          store.set(storageKey, arr);
        }

        function refreshTable() {
          var data = loadAll();
          var $table = $('#saved-table');
          var $empty = $('#saved-empty');
          var $tbody = $table.find('tbody');
          $tbody.empty();
          if (data.length === 0) {
            $table.hide();
            $empty.show();
            return;
          }
          $empty.hide();
          $table.show();
          data.forEach(function(item, idx){
            var tr = $('<tr>');
            tr.append($('<td>').text(item.name || ''));
            tr.append($('<td>').text(item.details || ''));
            var whenText = item.datetime ? moment(item.datetime).format('YYYY-MM-DD HH:mm') : '';
            tr.append($('<td>').text(whenText));
            tr.append($('<td>').text((item.tags || []).join(', ')));
            var delBtn = $('<button>', { class: 'btn btn-xs btn-danger' }).text('Delete').on('click', function(){
              var all = loadAll();
              all.splice(idx, 1);
              saveAll(all);
              refreshTable();
            });
            tr.append($('<td>').append(delBtn));
            $tbody.append(tr);
          });
        }

        $('#deadline-form').on('submit', function(e){
          e.preventDefault();
          var name = $('#name').val().trim();
          var details = $('#details').val().trim();
          var datetime = $('#datetime').val(); // datetime-local returns 'YYYY-MM-DDTHH:mm'
          var tags = parseTags($('#tags').val());
          if (!name || !datetime) {
            alert('Please enter name and deadline time.');
            return;
          }
          var entries = loadAll();
          entries.push({ name: name, details: details, datetime: datetime, tags: tags });
          saveAll(entries);
          // Reset and update table
          this.reset();
          refreshTable();
        });

        $('#clear-all').on('click', function(){
          if (confirm('This will remove all your saved deadlines in this browser. Continue?')) {
            saveAll([]);
            refreshTable();
          }
        });

        refreshTable();
      })();
    </script>
  </body>
  </html>


