## Build static site with Jekyll, then serve via Nginx and proxy /api to backend

FROM ruby:3.3-alpine AS builder
WORKDIR /app
RUN apk add --no-cache build-base gcc g++ make
COPY Gemfile .
RUN bundle install
COPY . .
# Build Jekyll site into /out
RUN bundle exec jekyll build -d /out

FROM nginx:alpine AS runtime
COPY nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=builder /out /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]

